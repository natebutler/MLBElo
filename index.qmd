---
title: "MLB Elo Ratings"
format:
  html:
    embed-resources: true
    fig-align: center
    df-print: paged
echo: false
---

```{r}
#| message: false
# load required packages
library(httr)
library(jsonlite)
library(tidyverse)
library(dplyr)
library(stringr)
library(tibble)
library(tidyr)
library(purrr)
library(mlbplotR)
library(gt)
```

```{r}
#| message: false
# load data
elo_ratings = readRDS("elo_rating.rds")
```

```{r}
latest_elo_df <- elo_ratings %>%
  group_by(Team) %>%
  filter(Date == max(Date)) %>%
  ungroup()

latest_elo_df %>%
  select(`Elo Rank`, "Logo" = team_logo_espn, Team, `Elo Rating`, 
         `Daily Elo Change`, Wins, Losses) %>%
  gt() %>%
  text_transform(
    locations = cells_body(c(Logo)),
    fn = function(x) {
      web_image(url = x, height = 40)
    }
  )

```

```{r}
#| fig-width: 12
#| fig-height: 18
ggplot(elo_ratings, aes(x = as.Date(Date), y = `Elo Rating`, group = team_abbr, color = team_abbr)) +
  geom_line(linewidth = 1) +
  geom_mlb_scoreboard_logos(
    data = latest_elo_df,
    mapping = aes(x = as.Date(Date), y = `Elo Rating`, team_abbr = team_abbr),
    inherit.aes = FALSE,
    width = 0.04
  ) +
  scale_color_mlb(type = "primary") +
  scale_y_continuous(
    limits = c(1425, 1550),
    breaks = seq(1425, 1550, by = 25)
  ) +
  labs(
    title = "MLB Elo Ratings Over Time",
    x = "Date",
    y = "Elo Rating"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text = element_text(size = 14),    # Adjust axis text size
    axis.title = element_text(size = 16),   # Adjust axis title size
    plot.title = element_text(size = 24),   # Adjust plot title size
    legend.text = element_text(size = 12)   # Adjust legend text size
  )


```


Last Updated: `r {Sys.setenv(TZ = "America/Chicago"); format(Sys.time(), "%Y-%m-%d %H:%M %Z")}`
